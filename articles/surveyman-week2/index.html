<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>
    Week 2 - Surveyman - hack(pravj) | Pravendra Singh
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">

<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="My name is Pravendra Singh and I love playing with data. R(ETL)PL."/>
<meta name="keywords" content="blog, web, data, data visualization, golang, programming, python, Pravendra Singh, Pravendra, pravj, IIT, IIT Roorkee">
<meta name="author" content="Pravendra Singh">
<meta http-equiv="cleartype" content="on">

  <meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Pravendra Singh - Falling Leaves">
<meta property="og:title" content="Week 2 - Surveyman" />
<meta property="og:type" content="article" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://pravj.github.io/articles/surveyman-week2/" />
<meta property="og:description" content="After the drop targets and drag sources were configured last week, this week my primary motive was to develop a better UI for adding Question types. After mulling over the UI a bit, I decided to replace the existing Javascript prompt with a modal which would allow text entry and multiple radio buttons / checkboxes to configure various parts of a Question type.
  Adding a Bootstrap Modal   UI  The key idea behind Surveyman is that by giving survey authors a way to write their surveys that steers them away from unnecessary ordering constraints, we can apply static analysis, randomization, and statistical dynamic analysis to locate survey errors and ensure the quality of responses." />

<meta property="og:image" content=" http://pravj.github.io/images/pravj-monu-art.jpg "/>

<meta property="article:author" content="https://www.facebook.com/hackpravj" />
<meta property="article:publisher" content="https://www.facebook.com/hackpravj" />

  <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@hackpravj">
<meta name="twitter:creator" content="@hackpravj">
<meta name="twitter:title" content="Week 2 - Surveyman" />
<meta name="twitter:description" content="After the drop targets and drag sources were configured last week, this week my primary motive was to develop a better UI for adding Question types. After mulling over the UI a bit, I decided to replace the existing Javascript prompt with a modal which would allow text entry and multiple radio buttons / checkboxes to configure various parts of a Question type.
  Adding a Bootstrap Modal   UI  The key idea behind Surveyman is that by giving survey authors a way to write their surveys that steers them away from unnecessary ordering constraints, we can apply static analysis, randomization, and statistical dynamic analysis to locate survey errors and ensure the quality of responses." />


<meta property="twitter:image" content=" http://pravj.github.io/images/pravj-monu-art.jpg "/>





  <link href='https://fonts.googleapis.com/css?family=Raleway:400|Source+Serif+Pro:400,300,600' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="https://pravj.github.io/styles.min.css">

  

  

  
  <link rel="apple-touch-icon" sizes="180x180" href="/images/header-images/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/images/header-images/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/header-images/favicon-16x16.png" sizes="16x16">
  <link rel="mask-icon" href="/images/header-images/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/header-images/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/images/header-images/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="hack(pravj)" />


  
</head>


<body>
      <div class="post-header">
  <div class="container rrr">
    <div class="row">
      <div class="six columns">
        <h4><a href="/">PRAVENDRA SINGH</a></h4>
      </div>
      <div class="six columns">
        <nav>
          <ul class="nav-list">
            <li><a href="/about" title="About Me"><i class="icon-user"></i></a></li>
            <li><a href="/blog" title="Articles"><i class="icon-article-alt"></i></a></li>
            <li><a href="/projects" title="Projects"><i class="icon-github-circled"></i></a></li>
            <li><a href="/quotes" title="Quotes"><i class="icon-quote-left"></i></a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>




  <div class="container">
    <div class="row">

      <section>
            <h1 class="post-title">
              <a href="/articles/surveyman-week2/">Week 2 - Surveyman</a>
            </h1>

          <div class="post-content-meta">

            
              <i class="icon-calendar"></i>  
              <span class="post-date">
                <span class="post-date-month">April</span> 
                <span class="post-date-day"> 13, </span>
                <span class="post-date-year">2015</span>
              </span> 
            

            
            
                <span class="post-tag"> in </span>
                
                <a class="post-tag post-tag-react" href="https://pravj.github.io/tags/react">
                  <i class="icon-tag"></i>react</a>
                
                <a class="post-tag post-tag-surveyman" href="https://pravj.github.io/tags/surveyman">
                  <i class="icon-tag"></i>surveyman</a>
                
            

         </div>

			

      <div class="post-content">
        

<p>After the drop targets and drag sources were configured last week, this week my primary motive was to develop a better UI for adding <code>Question</code> types. After mulling over the UI a bit, I decided to replace the existing Javascript <code>prompt</code> with a <code>modal</code> which would allow text entry and multiple radio buttons / checkboxes to configure various parts of a <code>Question</code> type.</p>

<figure><img src="/images/surveyman-modal.png"></img>
    <figcaption> Adding a Bootstrap Modal </figcaption>
</figure>

<h3 id="ui">UI</h3>

<blockquote>
<p>The key idea behind Surveyman is that by giving survey authors a way to write their surveys that steers them away from unnecessary ordering constraints, we can apply static analysis, randomization, and statistical dynamic analysis to locate survey errors and ensure the quality of responses.</p>
</blockquote>

<p>The extra configuration parameters allow survey authors to modify the behavior of Surveyman. For example, if you are adding a question where you don&rsquo;t want your options to be displayed in a random order, checking the <code>ordered</code> checkbox ensures that Surveyman shows the options in the order in which they were added.</p>

<p>The other half of this is displaying these parameters in a clear way to the users. For this, I decided on using the combo of meaningful icons and tooltips to communicate this information.</p>

<figure><img src="/images/surveyman-icons.png"></img>
    <figcaption> Icons for showing configuration </figcaption>
</figure>

<h3 id="architecture">Architecture</h3>

<p>To build this, I started off with migrating from <a href="https://getskeleton.com">Skeleton</a> to <a href="https://getbootstrap.com">Bootstrap</a> so that I could use the <a href="http://react-bootstrap.github.io">React-Bootstrap</a> library. The motivation here was to save time by using a set of prebuilt components that can be used right off the shelf. Apart from the modal, I knew that I&rsquo;d be needing an <code>Alert</code> and <code>Tooltip</code> very soon.</p>

<p>With that done, the next part was laying down the architecture for Modals. The key idea here was to setup an action that would be called when the question is dropped on a Block. This would then cause the store to change a piece of data, which in our case would be the <code>isOpen</code> property on the modal. The triggering of this change would then finally re-render the views.</p>

<p>All this sounds simple, especially once you have a look at the <a href="http://react-bootstrap.github.io/components.html#modals">sample code</a> for custom triggering a modal. But things start to get interesting once you start building the form inside the modal. How do you tag DOM elements so that you can retrieve their value when an event is called? Use <a href="https://facebook.github.io/react/docs/more-about-refs.html">refs</a> silly!</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;qtext&quot;</span><span class="p">&gt;</span>Question Text<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;What is value of 4 + 5?&quot;</span> 
      <span class="na">className</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;qtext&quot;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&quot;qtext&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>


<p>So I built a few form elements and tagged with them using refs and when I ran the application I got a cryptic error</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">Uncaught</span> <span class="nb">Error</span><span class="o">:</span> <span class="nx">Invariant</span> <span class="nx">Violation</span><span class="o">:</span> <span class="nx">addComponentAsRefTo</span><span class="p">(...)</span><span class="o">:</span> <span class="nx">Only</span> <span class="nx">a</span> <span class="nx">ReactOwner</span> <span class="nx">can</span> <span class="nx">have</span> <span class="nx">refs</span><span class="p">.</span> 
</code></pre></div>


<p>You can go dive deeper into the <a href="https://github.com/react-bootstrap/react-bootstrap/issues/223">issue</a> but the main idea here was with the way <code>renderOverlay</code> was rendering the DOM in a different DOM Tree. As a fix, I had to create a <code>BaseModal</code> component that would then rendered inside a <code>renderOverlay</code>.</p>

<p>The final <a href="https://github.com/prakhar1989/react-surveyman/blob/202dbd8520347e32322910834750942c43fb46e5/js/components/QuestionModal.js">component</a> looked like this -</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">BaseModal</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
   <span class="c1">// custom handler code</span>
   <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Modal</span> <span class="o">/&gt;</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">QuestionModal</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
   <span class="nx">mixins</span><span class="o">:</span> <span class="p">[</span><span class="nx">OverlayMixin</span><span class="p">],</span>
   <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;static-modal&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
   <span class="p">},</span>
   <span class="nx">renderOverlay</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
         <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">open</span> <span class="o">?</span> <span class="o">&lt;</span><span class="nx">BaseModal</span> <span class="nx">parentId</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">parentID</span><span class="p">}</span> <span class="o">/&gt;</span> 
                         <span class="o">:</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
      <span class="p">)</span>
   <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>The last step was simply rendering the <code>QuestionModal</code> in the <code>Application</code> component.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="c1">// in Application component</span>
<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
   <span class="o">&lt;</span><span class="nx">QuestionModal</span>
   <span class="nx">isOpen</span><span class="o">=</span><span class="p">{</span><span class="nx">modalState</span><span class="p">.</span><span class="nx">question</span><span class="p">}</span>
   <span class="nx">parentID</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">dropTargetID</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="p">}</span>
</code></pre></div>


<p>The other parts of the application were quite straightforward and got done rather quickly. I did get stuck with building a self-dismissing alert box but the React IRC channel helped out quite a bit.</p>

<p>If you&rsquo;ve read this far, go ahead and take the app for a <a href="http://prakhar.me/react-surveyman">spin</a>. For the complete code, feel free to browse the <a href="https://github.com/prakhar1989/react-surveyman">Github repository</a>.</p>

<p>This week my plan is to finish off in-place editing Block, Options and Questions. Stay tuned for the next post!</p>

      </div>
	
			

      </div>

      <div class="row paging">
			
          
          <div class="six columns">
            <a class="paging-link" href="/articles/surveyman-week1/"><i class="icon-left-open"></i> Week 1 - Surveyman</a>
          </div>
          

					
          <div class="paging-newer six columns">
            <a class="paging-link" href="/blog/development-story-of-puzzl/">Development story of puzzl <i class="icon-right-open"></i></a>
          </div>
          

      
       </div>


    </div>
  </div>

  
  <div class="container">
    <div class="row" id="disqus_area">
      <a href="#" id="disqus_load" onclick="return loadDisqus()">Add / View Comments</a>
<div id="disqus_thread"></div>

<script type="text/javascript">
  var disqus_shortname = 'pravj';

  function loadDisqus() {
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

  
  document.getElementById('disqus_load').style.display = 'none';
  return false;
}
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </div>
  


	

	

    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-48537986-1', 'auto');
  ga('send', 'pageview');
</script>

    </div>
      <div class="footer">
	<hr class="thin" />
  <p>Powered by <a href="https://gohugo.io/">Hugo</a> on <a href="https://pages.github.com/">GitHub Pages</a></p>
</div>

  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://pravj.github.io/main.js"></script>






<script async defer src="https://buttons.github.io/buttons.js"></script>



</body>
</html>
